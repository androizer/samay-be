packages:
  yum:
    epel-release: []
    certbot: []

files:
  "/opt/elasticbeanstalk/hooks/appdeploy/post/99_setup_ssl.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      DOMAIN="samay.prox.engineering"
      WWWDOMAIN="www.samay.prox.engineering"

      # Check if cert already exists
      if [ ! -f /etc/letsencrypt/live/$DOMAIN/fullchain.pem ]; then
        # Stop nginx temporarily (if running on 80)
        systemctl stop nginx || true

        # Request certificate
        certbot certonly --standalone -n --agree-tos --email you@example.com \
          -d $DOMAIN -d $WWWDOMAIN

        # Restart nginx after cert issuance
        systemctl start nginx || true
      fi

      # Setup auto-renew
      (crontab -l 2>/dev/null; echo "0 3 * * * certbot renew --quiet --renew-hook 'systemctl restart nginx || systemctl restart node || systemctl restart gunicorn'") | crontab -
